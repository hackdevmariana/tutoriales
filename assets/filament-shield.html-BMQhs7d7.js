import{_ as s,o as a,c as n,d as e}from"./app-CkpeseLt.js";const i={},p=e(`<h1 id="usuarios-y-roles-en-filamentphp-con-filament-shield" tabindex="-1"><a class="header-anchor" href="#usuarios-y-roles-en-filamentphp-con-filament-shield"><span>Usuarios y roles en FilamentPHP con filament-shield</span></a></h1><p>Filament Shield es una extensión de Filament que proporciona una interfaz de usuario para la gestión de recursos, como usuarios, roles y permisos.</p><p>Filament Shield agrega capacidades de autorización avanzadas a Filament, lo que permite definir políticas de acceso y restricciones basadas en roles para controlar quién puede acceder y realizar acciones en los diferentes recursos de tu aplicación.</p><p>Con Filament Shield, podemos definir políticas de autorización utilizando el sistema de políticas de Laravel, que permite especificar reglas personalizadas para determinar si un usuario tiene permiso para realizar una determinada acción en un recurso específico. Estas políticas de autorización se pueden aplicar a las vistas y acciones de los recursos en la interfaz de usuario de Filament, lo que permite controlar finamente qué usuarios pueden ver, crear, editar o eliminar registros en la aplicación.</p><p>Podemos definir fácilmente <strong>políticas de autorización</strong> utilizando la sintaxis familiar de Laravel, lo que permite especificar reglas personalizadas para determinar si un usuario tiene permiso para realizar una determinada acción en un recurso.</p><p>Podemos aplicar <strong>políticas de autorización a los recursos</strong> de tu aplicación para controlar quién puede ver, crear, editar o eliminar registros en la interfaz de usuario de Filament.</p><p>Filament Shield proporciona soporte integrado para <strong>roles y permisos</strong>, lo que permite asignar roles a los usuarios y definir permisos específicos para cada rol.</p><p>Podemos personalizar los <strong>mensajes de error</strong> que se muestran cuando un usuario intenta realizar una acción para la que no tiene permiso, lo que te permite proporcionar una experiencia de usuario coherente y comprensible.</p><p>Instalación:</p><div class="language-php line-numbers-mode" data-ext="php" data-title="php"><pre class="language-php"><code>composer <span class="token keyword">require</span> bezhansalleh<span class="token operator">/</span>filament<span class="token operator">-</span>shield
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>En <code>app/Models/User.php</code>, debemos añadir, si no lo tenemos:</p><div class="language-php line-numbers-mode" data-ext="php" data-title="php"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\\</span>Foundation<span class="token punctuation">\\</span>Auth<span class="token punctuation">\\</span>User</span> <span class="token keyword">as</span> Authenticatable<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Spatie<span class="token punctuation">\\</span>Permission<span class="token punctuation">\\</span>Traits<span class="token punctuation">\\</span>HasRoles</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>También:</p><div class="language-php line-numbers-mode" data-ext="php" data-title="php"><pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Authenticatable</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">HasRoles</span><span class="token punctuation">;</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>En caso de que ya tengamos definidos los usos, ya que podríamos tener algo así:</p><div class="language-php line-numbers-mode" data-ext="php" data-title="php"><pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Authenticatable</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">HasApiTokens</span><span class="token punctuation">,</span> HasFactory<span class="token punctuation">,</span> Notifiable<span class="token punctuation">;</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Añadiremos HasRoles:</p><div class="language-php line-numbers-mode" data-ext="php" data-title="php"><pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Authenticatable</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">HasApiTokens</span><span class="token punctuation">,</span> HasFactory<span class="token punctuation">,</span> Notifiable<span class="token punctuation">,</span> HasRoles<span class="token punctuation">;</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Publicamos la configuración del plugin:</p><div class="language-php line-numbers-mode" data-ext="php" data-title="php"><pre class="language-php"><code>php artisan vendor<span class="token punctuation">:</span>publish <span class="token operator">--</span>tag<span class="token operator">=</span>filament<span class="token operator">-</span>shield<span class="token operator">-</span>config
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>En los distintos paneles que tengamos, que se encuentran en <code>app/Providers/Filament</code>, incluimos el plugin:</p><div class="language-php line-numbers-mode" data-ext="php" data-title="php"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">panel</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Panel</span> <span class="token variable">$panel</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Panel</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$panel</span>
        <span class="token operator">-&gt;</span><span class="token function">plugins</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\\</span>BezhanSalleh<span class="token punctuation">\\</span>FilamentShield<span class="token punctuation">\\</span>FilamentShieldPlugin</span><span class="token operator">::</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Terminamos de instalar el plugin siguiendo las instrucciones del prompt:</p><div class="language-php line-numbers-mode" data-ext="php" data-title="php"><pre class="language-php"><code>php artisan shield<span class="token punctuation">:</span>install
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Este prompt nos irá indicando posibles errores.</p><p>Tanto si no hemos configurado bien el plugin:</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>ERROR  Please make sure your Auth Provider model (\\App\\Models\\User) uses either \`HasRoles\` or \`HasFilamentShield\` trait.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Como si tenemos alguna dependencia rota, como si creamos un resource y no hemos creado el modelo:</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>INFO  Generating permissions ...  


  ReflectionException

 Class &quot;App\\Models\\TestNews&quot; does not exist
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Por lo que, si bien, puede ser ligeramente engorroso, nos ayuda a detectar errores en nuestro proyecto.</p><p>Nos permite elegir qué usuario va a ser el superadministrador:</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>INFO  Creating a filament user with Super Admin Role...  

+----+-----------+-----------------------------+-------+
| ID | Name      | Email                       | Roles |
+----+-----------+-----------------------------+-------+
| 1  | Fernando  | fernando@midominio.com      |       |
| 2  | Webmaster | webmaster@midominio.com     |       |
+----+-----------+-----------------------------+-------+

┌ Please provide the \`UserID\` to be set as \`super_admin\` ──────┐
│ 1                                                            │
└──────────────────────────────────────────────────────────────┘
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Una vez instalado el plugin, continuamos con la integración en el proyecto. En <code>app/Models/User.php</code>, añadiremos, si no lo tenemos:</p><div class="language-php line-numbers-mode" data-ext="php" data-title="php"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">BezhanSalleh<span class="token punctuation">\\</span>FilamentShield<span class="token punctuation">\\</span>Traits<span class="token punctuation">\\</span>HasPanelShield</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Filament<span class="token punctuation">\\</span>Models<span class="token punctuation">\\</span>Contracts<span class="token punctuation">\\</span>FilamentUser</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\\</span>Foundation<span class="token punctuation">\\</span>Auth<span class="token punctuation">\\</span>User</span> <span class="token keyword">as</span> Authenticatable<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Spatie<span class="token punctuation">\\</span>Permission<span class="token punctuation">\\</span>Traits<span class="token punctuation">\\</span>HasRoles</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Authenticatable</span> <span class="token keyword">implements</span> <span class="token class-name">FilamentUser</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">HasRoles</span><span class="token punctuation">;</span>
    <span class="token keyword">use</span> <span class="token package">HasPanelShield</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Con esto, ya tendríamos configurado el plugin y veríamos en el panel de control la pestaña de &quot;Roles&quot;.</p><p>En ese apartado, seleccionaremos los permisos de cada usuario.</p><p>Una vez seleccionados, para hacerlos efectivos, podemos ejecutar:</p><div class="language-php line-numbers-mode" data-ext="php" data-title="php"><pre class="language-php"><code>php artisan shield<span class="token punctuation">:</span>generate
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Para publicar el recurso, ejecutaremos:</p><div class="language-php line-numbers-mode" data-ext="php" data-title="php"><pre class="language-php"><code>php artisan shield<span class="token punctuation">:</span>publish
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>que crea el fichero <code>app/Filament/Resources/Shield/RoleResource.php</code> y el directorio <code>app/Filament/Resources/Shield/RoleResource</code> con otros ficheros.</p><h2 id="usar-los-roles-y-permisos" tabindex="-1"><a class="header-anchor" href="#usar-los-roles-y-permisos"><span>Usar los roles y permisos</span></a></h2><p>Para usar los roles y permisos, vamos a <code>app/Filament/Resources/UserResource.php</code> y asignamos permisos a roles añadiendo en el apartado de formulario:</p><div class="language-php line-numbers-mode" data-ext="php" data-title="php"><pre class="language-php"><code><span class="token class-name class-name-fully-qualified static-context">Forms<span class="token punctuation">\\</span>Components<span class="token punctuation">\\</span>Select</span><span class="token operator">::</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;roles&#39;</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">relationship</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;roles&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;name&#39;</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">multiple</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">preload</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">searchable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// Using CheckboxList Component</span>
<span class="token class-name class-name-fully-qualified static-context">Forms<span class="token punctuation">\\</span>Components<span class="token punctuation">\\</span>CheckboxList</span><span class="token operator">::</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;roles&#39;</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">relationship</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;roles&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;name&#39;</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">searchable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Con esto, al acceder al panel de los usuarios, podemos asignar roles a los usuarios.</p>`,45),t=[p];function o(l,c){return a(),n("div",null,t)}const d=s(i,[["render",o],["__file","filament-shield.html.vue"]]),u=JSON.parse('{"path":"/laravel/filament-shield.html","title":"Usuarios y roles en FilamentPHP con filament-shield","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Usar los roles y permisos","slug":"usar-los-roles-y-permisos","link":"#usar-los-roles-y-permisos","children":[]}],"git":{"updatedTime":1714899027000,"contributors":[{"name":"fernando","email":"fernando@juandemariana.org","commits":1}]},"filePathRelative":"laravel/filament-shield.md"}');export{d as comp,u as data};
